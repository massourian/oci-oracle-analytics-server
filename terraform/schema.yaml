title: "Oracle Analytics Server - BYOL"

description: "Oracle Analytics Server deployed on Oracle Cloud Infrastructure compute"
schemaVersion: 1.0.0
version: "20210921"

stackDescription: "Oracle Analytics Server deployed on Oracle Cloud Infrastructure compute"

informationalText: "Oracle Analytics Server will be installed on the compute instance. 
Do not use the auto-generated SSH private key in a production environment. Instead, generate your own 
SSH key-pair and upload the public key for the compute instance. To connect to the compute instance, 
copy the SSH private key content into a file on your machine and run the following command: 
ssh - i <path to the pem file> opc@<Public IP for Oracle Analytics Server compute instance>"

source:
  type: marketplace
  reference: 111176886

locale: "en"
variableGroups:
  - title: "Oracle Analytics Server Compute Instance"
    variables:
      - ${instance_display_name}
      - ${mp_OAS_listing_id}
      - ${mp_OAS_listing_resource_version}
      - ${mp_OAS_listing_image_resource_id}
      - ${compartment_id}
      - ${availability_domain}
      - ${instance_shape}
      - ${ocpus}
      - ${memory_in_gbs}
      - ${boot_volume_size}
      - ${ssh_authorized_keys}

  - title: "Network Configuration"
    variables:
      - ${network_compartment_id}
      - ${existing_vcn_id}
      - ${subnet_id}
      - ${assign_public_ip}

  - title: "Oracle Analytics Server Domain Configuration"
    variables:
    - ${create_domain}
    - ${admin_user_name}
    - ${admin_password}
    - ${connect_string}
    - ${new_db_admin_username}
    - ${new_db_password}
    - ${oas_rcu_schema_prefix}
    - ${oas_rcu_schema_password}

variables:
  # General Configuration
  tenancy_ocid:
    title: Tenancy ID
    description: The Oracle Cloud Identifier (OCID) for your tenancy
    type: string
    required: true
    visible: false

  region:
    title: Region
    description: The region in which to create all resources
    type: oci:identity:region:name
    required: true
    visible: false

  compartment_id:
    title: Target Compartment
    description: The compartment in which to create all resources generated by this template
    type: oci:identity:compartment:id
    required: true

  user_ocid:
    title: User ID
    description: The Oracle Cloud Identifier (OCID) for the user
    type: string
    visible: false

  fingerprint:
    title: Private Key Fingerprint
    type: string
    visible: false

  private_key_path:
    title: Private Key Path
    type: string
    visible: false

  disable_auto_retries:
    required: false
    visible: false
    default: true

  # Oracle Analytics Server Instance
  instance_display_name:
    title: Display Name
    description: A name to identify compute instance generated by this template.
    type: string
    maxLength: 64
    pattern: "^([a-zA-Z_][a-zA-Z0-9\\-_]*)?$"
    required: true

  mp_OAS_listing_id:
    type: string
    visible: false

  mp_OAS_listing_resource_version:
    type: string
    visible: false
  
  mp_OAS_listing_image_resource_id:
    type: string
    visible: false

  availability_domain:
    title: Availability Domain
    description: The name of the availability domain in which to create the compute instance.
    type: oci:identity:availabilitydomain:name
    required: true
    dependsOn:
      compartmentId: ${compartment_id}

  boot_volume_size:
    title: Boot Volume Size
    description: The boot volume size in GB. The minimum volume is 400 GB and the maximum is 32768 GB.
    type: integer
    default: 400
    minimum: 400
    maximum: 32768 
    multipleOf: 1
    required: true

  ocpus:
    title: OCPUs
    description: The number of OCPUs for the compute instance.
    type: integer
    default: 1
    minimum: 1
    maximum: 64 
    required: true
    visible:
     or:
      - eq:
        - ${instance_shape}
        - "VM.Standard.E3.Flex"
      - eq:
        - ${instance_shape}
        - "VM.Standard.E4.Flex"

  memory_in_gbs:
    title: Memory
    description: The number of GB of memory for the compute instance.
    type: integer
    default: 15
    minimum: 1
    maximum: 1024
    required: true
    visible:
     or:
      - eq:
        - ${instance_shape}
        - "VM.Standard.E3.Flex"
      - eq:
        - ${instance_shape}
        - "VM.Standard.E4.Flex"
  
  instance_shape:
    title: Shape
    description: The shape for the compute instance.
    type: oci:core:instanceshape:name
    default: VM.Standard2.1
    required: true
    dependsOn:
      compartmentId: ${compartment_id}
      imageId: ${mp_OAS_listing_image_resource_id}
 
  # Network
  network_compartment_id:
    title: Network Compartment
    description: The compartment in which the network resources exists.
    type: oci:identity:compartment:id
    required: true

  existing_vcn_id:
    title: Virtual Cloud Network
    description: Select an existing VCN in which to create the compute instance.
    type: oci:core:vcn:id
    required: true
    dependsOn:
      compartmentId: ${network_compartment_id}

  subnet_id:
    title: Subnet
    description: Select an existing subnet for the compute instance.
    type: oci:core:subnet:id
    dependsOn:
      compartmentId: ${network_compartment_id}
      vcnId: ${existing_vcn_id}
      hidePrivateSubnet: false
    required: true

  assign_public_ip:
    title: Assign a public IP address to the compute instance 
    description: Only applicable if you select a public subnet. Donâ€™t select this option if the subnet is private. 
    type: boolean
    default: false

  ssh_authorized_keys:
    title: SSH Public Key
    description: Use the corresponding private key to access the compute instance.
    type: oci:core:ssh:publickey
    required: true
    sensitive: true

# Domain creation
  create_domain :
    title: Create Oracle Analytics Server Domain
    description: Select to create and configure an Oracle Analytics Server domain after installation. Domain creation takes about 30 minutes to complete after this stack job finishes.
    type: boolean
    default: false

  admin_user_name:
    title: Analytics Administrator Username
    description: Provide the name of the user that will administer Oracle Analytics Server
    type: string
    required: true
    visible: ${create_domain}

  admin_password:
    title: Analytics Administrator Password
    description: Provide the password for the Oracle Analytics Server administrator
    type: password
    required: true
    visible: ${create_domain}

  connect_string:
    title: Database Connection String
    description: Provide a connection string for the database in the format '<hostname or IP address>:<port>:<PDB_name>.<DB_domain>'. The database must be an Oracle Cloud virtual machine DB system. 
    type: string
    required: true
    visible: ${create_domain}

  new_db_admin_username:
    title: Database Administrator Username
    description: Provide new database administrator username
    type: string
    required: true
    visible: ${create_domain}

  new_db_password:
    title: Database Administrator Password
    description: Provide new database administrator password
    type: password
    required: true
    visible: ${create_domain}

  oas_rcu_schema_prefix:
    title: Database Schema Prefix
    description: Provide new database schema prefix
    maxLength: 12
    pattern: "^([a-zA-Z0-9])+$"
    type: string
    required: true
    visible: ${create_domain}

  oas_rcu_schema_password:
    title: Database Schema Password
    description: Provide new database schema password
    type: password
    required: true
    visible: ${create_domain}

  # Marketplace configuration
  marketplace_source_images:
    required: false
    visible: false

# output variable field names and values
outputs:
  compute_instance_public_ip:
    title: "Compute Instance Public IP"
    displayText: ${Messages.solutionsHub.solutions.ociDevTools.outputs.compute_instance_public_ip.displayText()}
    type: copyableString
    visible: true
  
  compute_instance_private_ip:
    title: "Compute Instance Private IP"
    displayText: ${Messages.solutionsHub.solutions.ociDevTools.outputs.compute_instance_private_ip.displayText()}
    type: copyableString
    visible: true
